# Semantic Pattern Query App - Environment Configuration

# ============================================================================
# Google Gemini API Configuration
# ============================================================================
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=your-gemini-api-key-here
GEMINI_EMBEDDING_MODEL=models/embedding-001

# ============================================================================
# Ollama Configuration
# ============================================================================
OLLAMA_MODEL=nomic-embed-text  # Embedding model
OLLAMA_GENERATION_MODEL=qwen3:14b  # Generation/chat model
OLLAMA_BASE_URL=http://localhost:11434

# Keep model loaded in memory for better stability (prevents EOF errors)
# Options: "5m", "10m", "30m", "1h", or "-1" for indefinite
# Recommended: "10m" for production (keeps model warm between requests)
OLLAMA_KEEP_ALIVE=10m

# ============================================================================
# Service URLs
# ============================================================================
QDRANT_URL=http://localhost:6333
ELASTICSEARCH_URL=http://localhost:9200
REDIS_HOST=localhost
REDIS_PORT=6380

# ============================================================================
# Pattern Library Path
# ============================================================================
PATTERN_LIBRARY_PATH=../pattern-library

# ============================================================================
# Embedding Configuration
# ============================================================================
# Default embedder type for queries ("ollama" or "gemini")
# This is the server default - UI can override on a per-query basis
QUERY_EMBEDDER_TYPE=ollama

# Calibration matrices for mapping premium embeddings to local space
# Generate these by running: ./venv/bin/python scripts/calibrate_embeddings.py
EMBEDDING_ALIGNMENT_MATRIX_PATH_GEMINI=alignment_matrix_gemini.npy
EMBEDDING_ALIGNMENT_MATRIX_PATH_OLLAMA=alignment_matrix_ollama.npy

# ============================================================================
# Web Search Configuration (Phase 1 - Enhanced with Trafilatura)
# ============================================================================
# Enable web search integration (true/false)
ENABLE_WEB_SEARCH=false

# Web search provider: "hybrid" (Trafilatura + DuckDuckGo), "trafilatura", "duckduckgo"
# - "hybrid": Trafilatura (primary) extracts full content, DuckDuckGo (fallback) provides URLs
# - "trafilatura": Trafilatura only (requires URLs as input)
# - "duckduckgo": DuckDuckGo only (snippets only, no full content extraction)
WEB_SEARCH_PROVIDER=hybrid

# Trafilatura settings (Primary - Full content extraction)
WEB_SEARCH_TRAFILATURA_TIMEOUT=10  # Timeout in seconds
WEB_SEARCH_TRAFILATURA_FAVOR_RECALL=true  # Prioritize completeness over precision

# DuckDuckGo settings (Fallback - URL discovery + snippets)
WEB_SEARCH_MAX_RESULTS=5  # Maximum web results per query
WEB_SEARCH_REGION=wt-wt  # Region code (wt-wt = worldwide)
WEB_SEARCH_SAFESEARCH=moderate  # Safety level: off, moderate, strict

# Trust scoring (applies to both Trafilatura and DuckDuckGo)
WEB_SEARCH_TRUST_SCORING=true  # Enable domain-based trust scoring

# Trusted domains for trust scoring (comma-separated, no spaces)
WEB_SEARCH_TRUSTED_DOMAINS=.gov,.edu,.org

# Rate limiting (applies to both providers)
WEB_SEARCH_MAX_QUERIES_PER_MINUTE=10

# ============================================
# Web Knowledge Base (Phase 2 - Tier 2)
# ============================================
# Enable persistent web knowledge base for caching and audit
ENABLE_WEB_KNOWLEDGE_BASE=true

# Web KB Collection Settings
WEB_KB_COLLECTION_NAME=web_knowledge  # Qdrant collection name
WEB_KB_TTL_DAYS=30  # Time-to-live for cached web results (days)
WEB_KB_MAX_SIZE=10000  # Maximum documents in Web KB
WEB_KB_ENABLE_AUTO_INGEST=true  # Auto-ingest live web results into KB
WEB_KB_ENABLE_AUTO_REFRESH=true  # Auto-refresh stale content
WEB_KB_REFRESH_THRESHOLD_DAYS=7  # Refresh content older than this

# Tier Weights (for weighted RRF fusion)
TIER_PATTERN_LIBRARY_WEIGHT=1.0  # Tier 1: Curated patterns (highest trust)
TIER_WEB_KB_WEIGHT=0.9  # Tier 2: Cached web results with audit trail
TIER_LIVE_WEB_WEIGHT=0.7  # Tier 3: Live web search (lowest trust)
